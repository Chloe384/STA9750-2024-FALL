<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>mp04 – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="mini-project-04-monte-carlo-informed-selection-of-cuny-retirement-plans" class="level1">
<h1>Mini Project #04: Monte Carlo-Informed Selection of CUNY Retirement Plans</h1>
<p>In this mini-project, the goal is to use Monte Carlo simulations to evaluate and inform the selection of a retirement plan based on various financial data. The code provided fetches historical data from multiple sources, including AlphaVantage and FRED, which is then used to model the performance of different asset classes. Here’s an explanation of the key components of the code.</p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>At the <a href="https://www.cuny.edu/">City University of New York (CUNY)</a>, new faculty members must decide between <a href="https://www.cuny.edu/wp-content/uploads/sites/4/page-assets/about/administration/offices/hr/benefits/Benefits-Guide-Retirement-Plans-Final-HEO-and-ECP.pdf">two retirement plans</a> within 30 days. Given the long-term impact and significance of this decision, it is essential that they carefully weigh their options, as this choice will shape their financial security throughout retirement.</p>
</section>
<section id="cuny-retirement-plans" class="level2">
<h2 class="anchored" data-anchor-id="cuny-retirement-plans">CUNY Retirement Plans</h2>
<p>The City University of New York (CUNY) provides its employees with a choice between two retirement plans: the traditional, defined-benefit Teachers Retirement System (TRS) plan, and the newer, defined-contribution Optional Retirement Plan (ORP).</p>
<section id="teachers-retirement-system" class="level3">
<h3 class="anchored" data-anchor-id="teachers-retirement-system">Teachers Retirement System</h3>
<p>The Teachers Retirement System (TRS) is a traditional, defined-benefit plan that guarantees employees a set monthly benefit upon retirement, based on factors like salary and years of service.</p>
</section>
<section id="optional-retirement-plan" class="level3">
<h3 class="anchored" data-anchor-id="optional-retirement-plan">Optional Retirement Plan</h3>
<p>In contrast, the Optional Retirement Plan (ORP) operates as a defined-contribution plan, where both employees and employers make contributions to individual investment accounts. The retirement benefits are determined by the performance of these investments.</p>
<p>This project aims to utilize historical financial data along with a bootstrap inference method to assess the two retirement plans available at CUNY, providing data-driven insights for employees’ retirement planning.</p>
<p>For this analysis, we will use data from two primary financial and economic sources: AlphaVantage and the Federal Reserve Economic Data (FRED) repository. AlphaVantage is a commercial data provider offering APIs that deliver both real-time and historical stock market data. The FRED repository, managed by the Federal Reserve Bank of St.&nbsp;Louis, grants access to an extensive range of economic data and financial metrics.</p>
</section>
</section>
<section id="data-sources" class="level2">
<h2 class="anchored" data-anchor-id="data-sources">Data Sources</h2>
<p>For this project, we will be accessing data from both AlphaVantage and FRED through their password-protected APIs. Before accessing these APIs, we will need to register for API keys for each of the respective APIs: <a href="https://www.alphavantage.co/support/#api-key">AlphaVantage registration</a> and <a href="https://fredaccount.stlouisfed.org/login/secure/">FRED registration</a>.</p>
<p>First, we will begin with importing all the necessary libraries required for this project.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install necessary packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"dplyr"</span>)) <span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"tidyverse"</span>)) <span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"sf"</span>)) <span class="fu">install.packages</span>(<span class="st">"sf"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"haven"</span>)) <span class="fu">install.packages</span>(<span class="st">"haven"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"DT"</span>)) <span class="fu">install.packages</span>(<span class="st">"DT"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"gt"</span>)) <span class="fu">install.packages</span>(<span class="st">"gt"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"ggplot2"</span>)) <span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"RColorBrewer"</span>)) <span class="fu">install.packages</span>(<span class="st">"RColorBrewer"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"stringr"</span>)) <span class="fu">install.packages</span>(<span class="st">"stringr"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"patchwork"</span>)) <span class="fu">install.packages</span>(<span class="st">"patchwork"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"gganimate"</span>)) <span class="fu">install.packages</span>(<span class="st">"gganimate"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"zoom"</span>)) <span class="fu">install.packages</span>(<span class="st">"zoom"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"gridExtra"</span>)) <span class="fu">install.packages</span>(<span class="st">"gridExtra"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"httr2"</span>)) <span class="fu">install.packages</span>(<span class="st">"httr2"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"readxl"</span>)) <span class="fu">install.packages</span>(<span class="st">"readxl"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"ggcorrplot"</span>)) <span class="fu">install.packages</span>(<span class="st">"ggcorrplot"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"knitr"</span>)) <span class="fu">install.packages</span>(<span class="st">"knitr"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages into R</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoom)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra) </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl) </span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot) </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, we will get the API keys and url links from AlphaVantage and FRED.</p>
</section>
<section id="task-1-register-for-alphavantage-api-key" class="level2">
<h2 class="anchored" data-anchor-id="task-1-register-for-alphavantage-api-key">Task 1: Register for AlphaVantage API Key</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>apikey <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"C:/Users/zhuol/OneDrive/Documents/STA9750-2024-FALL/API Key"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ALPHAVANTAGE_URL <span class="ot">&lt;-</span> <span class="st">"https://www.alphavantage.co/query"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="task-2-register-for-fred-api-key" class="level2">
<h2 class="anchored" data-anchor-id="task-2-register-for-fred-api-key">Task 2: Register for FRED API Key</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>FRED_URL <span class="ot">&lt;-</span> <span class="st">"https://api.stlouisfed.org/fred/series/observations"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>fredkey <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"C:/Users/zhuol/OneDrive/Documents/STA9750-2024-FALL/FRED Key"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-acquisition" class="level2">
<h2 class="anchored" data-anchor-id="data-acquisition">Data Acquisition</h2>
<p>To begin the Monte Carlo analysis, we will need historical data covering the following:</p>
<ul>
<li>Wage Growth</li>
<li>Inflation</li>
<li>US Equities</li>
<li>International Equities</li>
<li>Bond</li>
<li>Short-Term</li>
</ul>
<p>For each of these data set retrievals, we will be utilizing the functions from the <code>httr2</code> package. First, we will define the URL and set up the respective parameters for the metrics we want to retrieve based on each API’s documentation (<a href="https://www.alphavantage.co/documentation/">AlphaVantage documentation</a> and <a href="https://fred.stlouisfed.org/docs/api/fred/">FRED documentation</a>). Then, after performing the request, we will need to read in the content from the API response.</p>
<p>Below are the 6 data sets retrieved from either the AlphaVantage or FRED API’s. There are various data sets to choose from for each of these metrics, the choice made is dependent on various factors such as the extent of historical data.</p>
<section id="wage-growth" class="level4">
<h4 class="anchored" data-anchor-id="wage-growth">Wage Growth</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory and path for saving the file</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>save_path_wage <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir, <span class="st">"wage.zip"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the file doesn't exist locally and download it if necessary</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(save_path_wage)) {</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Request data from FRED API for wage data</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  fred_req_wage <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.stlouisfed.org/fred/series/observations"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_url_query</span>(</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">series_id =</span> <span class="st">"FRBATLWGT3MMAUMHWGWSFT"</span>,  <span class="co"># Series ID for wage data</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">api_key =</span> fredkey,                <span class="co"># FRED API key</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file_type =</span> <span class="st">"xls"</span>                      <span class="co"># Specify Excel file type</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform the request and save the response as a raw file</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  fred_resp_wage <span class="ot">&lt;-</span> fred_req_wage <span class="sc">|&gt;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save the raw data to the specified file path</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  fred_resp_wage <span class="sc">|&gt;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_body_raw</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeBin</span>(save_path_wage)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Define temporary directory and extract the contents of the ZIP file</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>td <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>zip_contents_wage <span class="ot">&lt;-</span> <span class="fu">unzip</span>(save_path_wage, <span class="at">exdir =</span> td)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the Excel file from the extracted contents</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>fred_wage <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(zip_contents_wage, <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>wage_growth_data <span class="ot">&lt;-</span> fred_wage <span class="sc">|&gt;</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">'observation_date'</span>, <span class="st">'FRBATLWGT3MMAUMHWGWSFT'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">wage_growth =</span> <span class="st">'FRBATLWGT3MMAUMHWGWSFT'</span>) <span class="co"># annualized median wage growth rate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="inflation" class="level4">
<h4 class="anchored" data-anchor-id="inflation">Inflation</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory and path for saving the file</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>save_path_inflation <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir, <span class="st">"inflation.zip"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the file doesn't exist locally and download it if necessary</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(save_path_inflation)) {</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Request data from FRED API for inflation data (CPI)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  fred_req_inflation <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.stlouisfed.org/fred/series/observations"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_url_query</span>(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">series_id =</span> <span class="st">"FPCPITOTLZGUSA"</span>,  <span class="co"># Series ID for CPI (Consumer Price Index)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">api_key =</span> fredkey,              <span class="co"># FRED API key</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file_type =</span> <span class="st">"xls"</span>               <span class="co"># Specify Excel file type</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform the request and save the response as a raw file</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  fred_resp_inflation <span class="ot">&lt;-</span> fred_req_inflation <span class="sc">|&gt;</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save the raw data to the specified file path</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  fred_resp_inflation <span class="sc">|&gt;</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_body_raw</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeBin</span>(save_path_inflation)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Define temporary directory and extract the contents of the ZIP file</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>td <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>zip_contents_inflation <span class="ot">&lt;-</span> <span class="fu">unzip</span>(save_path_inflation, <span class="at">exdir =</span> td)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the Excel file from the extracted contents</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>fred_inflation <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(zip_contents_inflation, <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Select and clean the data for inflation rate calculation</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>inflation_data <span class="ot">&lt;-</span> fred_inflation <span class="sc">|&gt;</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">'observation_date'</span>, <span class="st">'FPCPITOTLZGUSA'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">inflation_rate =</span> <span class="st">'FPCPITOTLZGUSA'</span>)  <span class="co"># Rename CPI column to 'inflation_rate'</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally: Convert the data to date format and process inflation growth</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>inflation_data <span class="ot">&lt;-</span> inflation_data <span class="sc">|&gt;</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">observation_date =</span> <span class="fu">as.Date</span>(observation_date),</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">inflation_growth =</span> (inflation_rate <span class="sc">/</span> <span class="fu">lag</span>(inflation_rate) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>  <span class="co"># Calculate the period-to-period growth rate</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()  <span class="co"># Drop NA values for calculations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="us-equity-market-returns" class="level4">
<h4 class="anchored" data-anchor-id="us-equity-market-returns">US Equity Market Returns</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Request monthly adjusted data for SPY (U.S. Equity Market)</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>spy_file <span class="ot">&lt;-</span> <span class="fu">request</span>(ALPHAVANTAGE_URL) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_path</span>(<span class="st">"query"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_MONTHLY"</span>,  <span class="co"># Request monthly time series data</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">apikey =</span> apikey,                     <span class="co"># AlphaVantage API key</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">datatype =</span> <span class="st">"csv"</span>,                    <span class="co"># Data format as CSV</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span> <span class="st">"SPY"</span>                       <span class="co"># Symbol for the Vanguard Total Stock Market ETF</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the CSV data for SPY (U.S. Equity Market)</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>spy_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">resp_body_string</span>(spy_file))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory and path for saving the file</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>save_path_us_equity <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir, <span class="st">"us_equity.zip"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the file doesn't exist locally and download it if necessary</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(save_path_us_equity)) {</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Request data from FRED API for US Equities (S&amp;P 500 Index)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  fred_req_us_equity <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.stlouisfed.org/fred/series/observations"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_url_query</span>(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">series_id =</span> <span class="st">"SP500"</span>,  <span class="co"># Series ID for S&amp;P 500 Index</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">api_key =</span> fredkey,    <span class="co"># FRED API key</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file_type =</span> <span class="st">"xls"</span>     <span class="co"># Specify Excel file type</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform the request and save the response as a raw file</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  fred_resp_us_equity <span class="ot">&lt;-</span> fred_req_us_equity <span class="sc">|&gt;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save the raw data to the specified file path</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  fred_resp_us_equity <span class="sc">|&gt;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_body_raw</span>() <span class="sc">|&gt;</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeBin</span>(save_path_us_equity)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Define temporary directory and extract the contents of the ZIP file</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>td <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>zip_contents_us_equity <span class="ot">&lt;-</span> <span class="fu">unzip</span>(save_path_us_equity, <span class="at">exdir =</span> td)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the Excel file from the extracted contents</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>fred_us_equity <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(zip_contents_us_equity, <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Select and clean the data for US Equities</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>us_equity_data <span class="ot">&lt;-</span> fred_us_equity <span class="sc">|&gt;</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">'observation_date'</span>, <span class="st">'SP500'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">us_equity_index =</span> <span class="st">'SP500'</span>)  <span class="co"># Rename column for clarity</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="international-equity-market-returns" class="level4">
<h4 class="anchored" data-anchor-id="international-equity-market-returns">International Equity Market Returns</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory and path for saving the file</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>save_path_intl_equity <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir, <span class="st">"intl_equity.zip"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the file doesn't exist locally and download it if necessary</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(save_path_intl_equity)) {</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Request data from FRED API for International Equities</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  fred_req_intl_equity <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.stlouisfed.org/fred/series/observations"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_url_query</span>(</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">series_id =</span> <span class="st">"IR14270"</span>,  <span class="co"># Series ID for World Stock Market Capitalization (Non-US)</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">api_key =</span> fredkey,      <span class="co"># FRED API key</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file_type =</span> <span class="st">"xls"</span>       <span class="co"># Specify Excel file type</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform the request and save the response as a raw file</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  fred_resp_intl_equity <span class="ot">&lt;-</span> fred_req_intl_equity <span class="sc">|&gt;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save the raw data to the specified file path</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  fred_resp_intl_equity <span class="sc">|&gt;</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_body_raw</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeBin</span>(save_path_intl_equity)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Define temporary directory and extract the contents of the ZIP file</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>td <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>zip_contents_intl_equity <span class="ot">&lt;-</span> <span class="fu">unzip</span>(save_path_intl_equity, <span class="at">exdir =</span> td)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the Excel file from the extracted contents</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>fred_intl_equity <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(zip_contents_intl_equity, <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Select and clean the data for International Equities</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>intl_equity_data <span class="ot">&lt;-</span> fred_intl_equity <span class="sc">|&gt;</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">'observation_date'</span>, <span class="st">'IR14270'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">intl_equity_index =</span> <span class="st">'IR14270'</span>)  <span class="co"># Rename column for clarity</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="bond-market-returns" class="level4">
<h4 class="anchored" data-anchor-id="bond-market-returns">Bond market returns</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory and path for saving the file</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>save_path_bond <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir, <span class="st">"bond.zip"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the file doesn't exist locally and download it if necessary</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(save_path_bond)) {</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Request data from FRED API for 10-year treasury bond yields</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  fred_req_bond <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.stlouisfed.org/fred/series/observations"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_url_query</span>(</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">series_id =</span> <span class="st">"GS10"</span>,  <span class="co"># Series ID for 10-year treasury yield</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">api_key =</span> fredkey,    <span class="co"># FRED API key</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file_type =</span> <span class="st">"xls"</span>     <span class="co"># Specify Excel file type</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform the request and save the response as a raw file</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  fred_resp_bond <span class="ot">&lt;-</span> fred_req_bond <span class="sc">|&gt;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save the raw data to the specified file path</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  fred_resp_bond <span class="sc">|&gt;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_body_raw</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeBin</span>(save_path_bond)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Define temporary directory and extract the contents of the ZIP file</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>td <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>zip_contents_bond <span class="ot">&lt;-</span> <span class="fu">unzip</span>(save_path_bond, <span class="at">exdir =</span> td)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the Excel file from the extracted contents</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>fred_bond <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(zip_contents_bond, <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Select and clean the data for bond market returns</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>bond_data <span class="ot">&lt;-</span> fred_bond <span class="sc">|&gt;</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">'observation_date'</span>, <span class="st">'GS10'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">bond_yield =</span> <span class="st">'GS10'</span>)  <span class="co"># Rename column for clarity</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="short-term-debt-returns" class="level4">
<h4 class="anchored" data-anchor-id="short-term-debt-returns">Short-Term Debt Returns</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory and path for saving the file</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>save_path_short_term <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir, <span class="st">"short_term_debt.zip"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the file doesn't exist locally and download it if necessary</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(save_path_short_term)) {</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Request data from FRED API for Short-Term Debt (2-Year Treasury Yield)</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  fred_req_short_term <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.stlouisfed.org/fred/series/observations"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_url_query</span>(</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">series_id =</span> <span class="st">"GS2"</span>,  <span class="co"># Series ID for 2-Year Treasury Yield</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">api_key =</span> fredkey,   <span class="co"># FRED API key</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file_type =</span> <span class="st">"xls"</span>    <span class="co"># Specify Excel file type</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform the request and save the response as a raw file</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  fred_resp_short_term <span class="ot">&lt;-</span> fred_req_short_term <span class="sc">|&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save the raw data to the specified file path</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  fred_resp_short_term <span class="sc">|&gt;</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_body_raw</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeBin</span>(save_path_short_term)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Define temporary directory and extract the contents of the ZIP file</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>td <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>zip_contents_short_term <span class="ot">&lt;-</span> <span class="fu">unzip</span>(save_path_short_term, <span class="at">exdir =</span> td)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the Excel file from the extracted contents</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>short_term_debt <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(zip_contents_short_term, <span class="at">sheet =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="task-4-investigation-and-visualization-of-input-data" class="level2">
<h2 class="anchored" data-anchor-id="task-4-investigation-and-visualization-of-input-data">Task 4: Investigation and Visualization of Input Data</h2>
<p>Before beginning our retirement plan comparison analysis, we will do some preliminary exploration analysis on the 6 data sets imported to get familiar with our data. For the purposes of this project and to maintain consistency, we will only use data from the last 20 years (2005-2024).</p>
<p>Let’s first take a look at the wage growth and inflation data sets. Taking a look at the wage growth and inflation data simultaneously gives us a better understanding of the purchasing power and living standards of each specific time period. Both these metrics will be important for individuals’ financial planning throughout their career.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine wage growth and inflation data</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>inflation_wage <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(wage_growth_data, inflation_data, <span class="at">by =</span> <span class="st">"observation_date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(observation_date) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate monthly inflation if not directly available; otherwise, use the inflation_rate column if available</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inflation =</span> <span class="fu">round</span>((inflation_rate <span class="sc">-</span> <span class="fu">lag</span>(inflation_rate)) <span class="sc">/</span> <span class="fu">lag</span>(inflation_rate) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(observation_date) <span class="sc">&gt;</span> <span class="dv">2004</span>)  <span class="co"># Only use data from the past 20 years</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The following graph shows the change in wage growth and inflation rates over time from 2005 to 2024.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(inflation_wage, <span class="fu">aes</span>(<span class="at">x =</span> observation_date)) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> inflation_rate, <span class="at">color =</span> <span class="st">"Inflation"</span>), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span>  <span class="co"># Inflation line</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> wage_growth, <span class="at">color =</span> <span class="st">"Wage Growth"</span>), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span>  <span class="co"># Wage Growth line</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Inflation"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Wage Growth"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span>  <span class="co"># Custom colors for the lines</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Inflation and Wage Growth Over Time"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Rate (%)"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Legend"</span>) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># Clean and simple theme</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),  <span class="co"># Title customization</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),  <span class="co"># Axis titles customization</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),  <span class="co"># Axis labels customization</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"top"</span>)  <span class="co"># Place the legend at the top</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In addition, I want to measure the correlation of factors such as averages and variances for wage and inflation.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate long-term averages (mean) and variances for wage growth and inflation</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>wage_inflation_stats <span class="ot">&lt;-</span> inflation_wage <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_wage_growth =</span> <span class="fu">mean</span>(wage_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_wage_growth =</span> <span class="fu">var</span>(wage_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_inflation_rate =</span> <span class="fu">mean</span>(inflation_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_inflation_rate =</span> <span class="fu">var</span>(inflation_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correlation between wage growth and inflation</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>correlation <span class="ot">&lt;-</span> <span class="fu">cor</span>(inflation_wage<span class="sc">$</span>wage_growth, inflation_wage<span class="sc">$</span>inflation_rate, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a summary table for wage growth and inflation</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Wage Growth (Avg)"</span>, <span class="st">"Wage Growth (Variance)"</span>, <span class="st">"Inflation Rate (Avg)"</span>, <span class="st">"Inflation Rate (Variance)"</span>, <span class="st">"Correlation"</span>),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(wage_inflation_stats<span class="sc">$</span>avg_wage_growth, <span class="dv">2</span>),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(wage_inflation_stats<span class="sc">$</span>var_wage_growth, <span class="dv">2</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(wage_inflation_stats<span class="sc">$</span>avg_inflation_rate, <span class="dv">2</span>),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(wage_inflation_stats<span class="sc">$</span>var_inflation_rate, <span class="dv">2</span>),</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(correlation, <span class="dv">2</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the summary table</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     Metric Value
1         Wage Growth (Avg)  3.52
2    Wage Growth (Variance)  1.19
3      Inflation Rate (Avg)  2.56
4 Inflation Rate (Variance)  3.43
5               Correlation  0.46</code></pre>
</div>
</div>
<p><strong>Average Wage Growth</strong>: Wage growth is an important indicator for economic well-being. If wage growth outpaces inflation, it suggests that workers’ purchasing power is increasing. In this case, an average of 3.52% suggests moderate wage improvements over the observed period.</p>
<p><strong>Variance of Wage Growth</strong>: A variance of 1.19 indicates some variability in the wage growth rates, but it’s relatively moderate compared to other economic factors. It suggests that while wages generally grew over time, the pace of growth was not consistent year after year. This could be due to external factors like economic recessions, inflationary shocks, or changes in labor market conditions.</p>
<p><strong>Average Inflation Rate</strong>: An average inflation rate of 2.56% is relatively moderate. Typically, central banks target an inflation rate of around 2%, so this figure suggests a fairly stable price environment. A moderate inflation rate like this usually allows for economic growth while avoiding the negative effects of both high inflation (which erodes purchasing power) and deflation (which can stifle economic activity).</p>
<p><strong>Variance of Inflation rate</strong>: A variance of 3.43 suggests periods of significant inflationary volatility, possibly due to external economic shocks (e.g., energy price fluctuations, supply chain disruptions) or changing economic conditions (e.g., fiscal policy, demand shocks). This can be more concerning because high variability in inflation can make it harder for consumers and businesses to plan financially.</p>
<p><strong>Correlation</strong>: The moderate correlation of 0.46 indicates that while wage growth and inflation are somewhat related, other economic factors play significant roles in influencing each of these metrics. Understanding this relationship can be useful for financial planning, as the purchasing power of wages is directly impacted by inflation.</p>
<p>The graph below depicts the correlation between wage and inflation.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the relationship between wage growth and inflation rate</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(inflation_wage, <span class="fu">aes</span>(<span class="at">x =</span> inflation_rate, <span class="at">y =</span> wage_growth)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span>  <span class="co"># Add points</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Wage Growth and Inflation Rate"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Inflation Rate (%)"</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Wage Growth (%)"</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now, let’s explore the correlations between US equity and international equities.</p>
<p>First, combine US equity data with the international equity data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine US equity and international equity data</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>equity_data <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(us_equity_data, intl_equity_data, <span class="at">by =</span> <span class="st">"observation_date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(observation_date) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(observation_date) <span class="sc">&gt;</span> <span class="dv">2004</span>)  <span class="co"># Only use data from the last 20 years</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns to simplify</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>equity_data <span class="ot">&lt;-</span> equity_data <span class="sc">%&gt;%</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_equity_return =</span> <span class="st">'us_equity_index'</span>,  <span class="co"># Replace with actual column name for US equity returns</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">international_equity_return =</span> <span class="st">'intl_equity_index'</span>  <span class="co"># Replace with actual column name for international equity returns</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, we plot the US Equity market returns against the International Equity market returns into a scattered plot. Looking at the plot, it looks like there’s a positive correlation between the two metrics. This suggests that as the market return for US equity rises, there’s a high likely possibility that the International equity’s market return will also rise.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>equity_data <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> us_equity_return,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> international_equity_return)) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"US Equity Market Returns vs International Equity Market Returns"</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"US Equity Market Returns"</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"International Equity Market Returns"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Lastly, let’s look at the correlation between bond return and short term debt return. Similar to what we did before, first we will combine the two datasets together to create a scattered plot.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine Bond Return and Short-Term Debt Return datasets by observation_date</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>bond_short_term_data <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(bond_data, short_term_debt, <span class="at">by =</span> <span class="st">"observation_date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(observation_date) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(observation_date) <span class="sc">&gt;</span> <span class="dv">2004</span>)  <span class="co"># Use data from the past 20 years (2005-2024)</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns for ease of use</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>bond_short_term_data <span class="ot">&lt;-</span> bond_short_term_data <span class="sc">%&gt;%</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">bond_return =</span> <span class="st">'bond_yield'</span>,  <span class="co"># Replace with actual column name for bond returns</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">short_term_debt_return =</span> <span class="st">'GS2'</span>  <span class="co"># Replace with actual column name for short-term debt returns</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the correlation between bond returns and short-term debt returns</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>correlation_bond_short_term <span class="ot">&lt;-</span> <span class="fu">cor</span>(bond_short_term_data<span class="sc">$</span>bond_return, bond_short_term_data<span class="sc">$</span>short_term_debt_return, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the scatter plot to visualize the relationship between bond return and short-term debt return</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bond_short_term_data, <span class="fu">aes</span>(<span class="at">x =</span> short_term_debt_return, <span class="at">y =</span> bond_return)) <span class="sc">+</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"green"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span>  <span class="co"># Add points with transparency</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line without confidence interval</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Bond Return and Short-Term Debt Return"</span>,</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Short-Term Debt Return (2-Year Treasury Yield) (%)"</span>,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Bond Return (%)"</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(correlation_bond_short_term)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8309487</code></pre>
</div>
</div>
<p>A correlation of 0.83 implies a strong and positive relationship between bond returns and short-term debt returns. This means that changes in one are typically reflected in changes in the other, and this information is crucial for making informed decisions about investing in these two types of fixed-income instruments. It also suggests that investors can expect similar movements in both asset classes, which could influence decisions about asset allocation and diversification in investment portfolios.</p>
</section>
<section id="task-5-historical-comparison" class="level2">
<h2 class="anchored" data-anchor-id="task-5-historical-comparison">Task 5: Historical Comparison</h2>
<p>In this task, we examine the hypothetical scenario of an employee hired by CUNY in 2005 and retiring in October 2024. We compare the total contributions to the Teacher Retirement System (TRS) and the Optional Retirement Plan (ORP) over the employee’s career, from 2005 to 2024. The analysis will highlight the differences in employer and employee contributions, providing insights into the better retirement plan option for the employee.</p>
<p>Assumptions for the Hypothetical Employee: - The employee is hired at age 40 in January 2005 with a starting salary of $75,000. - The salary grows at an annual rate of 3%. - The employee works for 20 years, retiring at age 60 at the end of October 2024. - Contributions to both retirement plans (TRS and ORP) are calculated based on the salary each year. - Employer contributions are fixed for TRS at 8% and for ORP, at 8% for the first 7 years and 10% thereafter.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set initial parameters</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>starting_salary <span class="ot">&lt;-</span> <span class="dv">75000</span>  <span class="co"># Starting salary for the hypothetical employee</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>salary_growth_rate <span class="ot">&lt;-</span> <span class="fl">0.03</span>  <span class="co"># Annual salary growth rate of 3%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>years_worked <span class="ot">&lt;-</span> <span class="dv">20</span>  <span class="co"># Number of years worked (2005 to 2024)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>retirement_age <span class="ot">&lt;-</span> <span class="dv">60</span>  <span class="co"># Age at retirement</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate employee and employer contributions for TRS and ORP</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>calculate_contributions <span class="ot">&lt;-</span> <span class="cf">function</span>(starting_salary, salary_growth_rate, years_worked) {</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize vectors to store the data</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  salary <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_worked)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  employee_contrib_trs <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_worked)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  employer_contrib_trs <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_worked)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  employee_contrib_orp <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_worked)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  employer_contrib_orp <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_worked)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  total_contrib_orp <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_worked)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  total_contrib_trs <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_worked)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  age <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_worked)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop through each year to calculate the data</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>years_worked) {</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    current_salary <span class="ot">&lt;-</span> starting_salary <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> salary_growth_rate)<span class="sc">^</span>(i<span class="dv">-1</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    age[i] <span class="ot">&lt;-</span> <span class="dv">35</span> <span class="sc">+</span> i  <span class="co"># Age starts at 35 and increases by 1 each year</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># TRS Contributions (based on salary)</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (current_salary <span class="sc">&lt;=</span> <span class="dv">45000</span>) {</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>      employee_contrib_trs[i] <span class="ot">&lt;-</span> current_salary <span class="sc">*</span> <span class="fl">0.03</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (current_salary <span class="sc">&lt;=</span> <span class="dv">55000</span>) {</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>      employee_contrib_trs[i] <span class="ot">&lt;-</span> current_salary <span class="sc">*</span> <span class="fl">0.035</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (current_salary <span class="sc">&lt;=</span> <span class="dv">75000</span>) {</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>      employee_contrib_trs[i] <span class="ot">&lt;-</span> current_salary <span class="sc">*</span> <span class="fl">0.045</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (current_salary <span class="sc">&lt;=</span> <span class="dv">100000</span>) {</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>      employee_contrib_trs[i] <span class="ot">&lt;-</span> current_salary <span class="sc">*</span> <span class="fl">0.0575</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>      employee_contrib_trs[i] <span class="ot">&lt;-</span> current_salary <span class="sc">*</span> <span class="fl">0.06</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Employer Contributions for TRS (Fixed 8% for simplicity, adjust if more info is available)</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    employer_contrib_trs[i] <span class="ot">&lt;-</span> current_salary <span class="sc">*</span> <span class="fl">0.08</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ORP Contributions (Employee contribution is similar to TRS)</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>    employee_contrib_orp[i] <span class="ot">&lt;-</span> employee_contrib_trs[i]  <span class="co"># Same contribution rate as TRS</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Employer Contributions for ORP (8% for first 7 years, 10% thereafter)</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">&lt;=</span> <span class="dv">7</span>) {</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>      employer_contrib_orp[i] <span class="ot">&lt;-</span> current_salary <span class="sc">*</span> <span class="fl">0.08</span></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>      employer_contrib_orp[i] <span class="ot">&lt;-</span> current_salary <span class="sc">*</span> <span class="fl">0.10</span></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Total Contributions for ORP</span></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    total_contrib_orp[i] <span class="ot">&lt;-</span> employee_contrib_orp[i] <span class="sc">+</span> employer_contrib_orp[i]</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Total Contributions for TRS (assuming no investment returns for simplicity)</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    total_contrib_trs[i] <span class="ot">&lt;-</span> employee_contrib_trs[i] <span class="sc">+</span> employer_contrib_trs[i]</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save salary value</span></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>    salary[i] <span class="ot">&lt;-</span> current_salary</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame with all the calculated data</span></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>  contributions_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">Year =</span> <span class="dv">2005</span> <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>(years_worked<span class="dv">-1</span>),</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">Salary =</span> salary,</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Employee Contributions (TRS)</span><span class="st">`</span> <span class="ot">=</span> employee_contrib_trs,</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Employer Contributions (TRS)</span><span class="st">`</span> <span class="ot">=</span> employer_contrib_trs,</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Contributions (TRS)</span><span class="st">`</span> <span class="ot">=</span> total_contrib_trs,</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Employee Contributions (ORP)</span><span class="st">`</span> <span class="ot">=</span> employee_contrib_orp,</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Employer Contributions (ORP)</span><span class="st">`</span> <span class="ot">=</span> employer_contrib_orp,</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Contributions (ORP)</span><span class="st">`</span> <span class="ot">=</span> total_contrib_orp,</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">Age =</span> age</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(contributions_data)</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the contributions</span></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>contributions_data <span class="ot">&lt;-</span> <span class="fu">calculate_contributions</span>(starting_salary, salary_growth_rate, years_worked)</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a comparison table using kable</span></span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(contributions_data, </span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Salary After Adjustments"</span>, <span class="st">"Employee Contributions (TRS)"</span>, </span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Employer Contributions (TRS)"</span>, <span class="st">"Total Contributions (TRS)"</span>, </span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Employee Contributions (ORP)"</span>, <span class="st">"Employer Contributions (ORP)"</span>, </span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Total Contributions (ORP)"</span>, <span class="st">"Age"</span>),</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"ORP Employee and Employer Yearly Contributions"</span>,</span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>))  <span class="co"># Align columns to the right</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>ORP Employee and Employer Yearly Contributions</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Salary After Adjustments</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Employee Contributions (TRS)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Employer Contributions (TRS)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total Contributions (TRS)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Employee Contributions (ORP)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Employer Contributions (ORP)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total Contributions (ORP)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2005</td>
<td style="text-align: right;">75000.00</td>
<td style="text-align: right;">3375.00</td>
<td style="text-align: right;">6000.00</td>
<td style="text-align: right;">9375.00</td>
<td style="text-align: right;">3375.00</td>
<td style="text-align: right;">6000.00</td>
<td style="text-align: right;">9375.00</td>
<td style="text-align: right;">36</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006</td>
<td style="text-align: right;">77250.00</td>
<td style="text-align: right;">4441.88</td>
<td style="text-align: right;">6180.00</td>
<td style="text-align: right;">10621.88</td>
<td style="text-align: right;">4441.88</td>
<td style="text-align: right;">6180.00</td>
<td style="text-align: right;">10621.88</td>
<td style="text-align: right;">37</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2007</td>
<td style="text-align: right;">79567.50</td>
<td style="text-align: right;">4575.13</td>
<td style="text-align: right;">6365.40</td>
<td style="text-align: right;">10940.53</td>
<td style="text-align: right;">4575.13</td>
<td style="text-align: right;">6365.40</td>
<td style="text-align: right;">10940.53</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008</td>
<td style="text-align: right;">81954.52</td>
<td style="text-align: right;">4712.39</td>
<td style="text-align: right;">6556.36</td>
<td style="text-align: right;">11268.75</td>
<td style="text-align: right;">4712.39</td>
<td style="text-align: right;">6556.36</td>
<td style="text-align: right;">11268.75</td>
<td style="text-align: right;">39</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2009</td>
<td style="text-align: right;">84413.16</td>
<td style="text-align: right;">4853.76</td>
<td style="text-align: right;">6753.05</td>
<td style="text-align: right;">11606.81</td>
<td style="text-align: right;">4853.76</td>
<td style="text-align: right;">6753.05</td>
<td style="text-align: right;">11606.81</td>
<td style="text-align: right;">40</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010</td>
<td style="text-align: right;">86945.56</td>
<td style="text-align: right;">4999.37</td>
<td style="text-align: right;">6955.64</td>
<td style="text-align: right;">11955.01</td>
<td style="text-align: right;">4999.37</td>
<td style="text-align: right;">6955.64</td>
<td style="text-align: right;">11955.01</td>
<td style="text-align: right;">41</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2011</td>
<td style="text-align: right;">89553.92</td>
<td style="text-align: right;">5149.35</td>
<td style="text-align: right;">7164.31</td>
<td style="text-align: right;">12313.66</td>
<td style="text-align: right;">5149.35</td>
<td style="text-align: right;">7164.31</td>
<td style="text-align: right;">12313.66</td>
<td style="text-align: right;">42</td>
</tr>
<tr class="even">
<td style="text-align: left;">2012</td>
<td style="text-align: right;">92240.54</td>
<td style="text-align: right;">5303.83</td>
<td style="text-align: right;">7379.24</td>
<td style="text-align: right;">12683.07</td>
<td style="text-align: right;">5303.83</td>
<td style="text-align: right;">9224.05</td>
<td style="text-align: right;">14527.89</td>
<td style="text-align: right;">43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2013</td>
<td style="text-align: right;">95007.76</td>
<td style="text-align: right;">5462.95</td>
<td style="text-align: right;">7600.62</td>
<td style="text-align: right;">13063.57</td>
<td style="text-align: right;">5462.95</td>
<td style="text-align: right;">9500.78</td>
<td style="text-align: right;">14963.72</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">2014</td>
<td style="text-align: right;">97857.99</td>
<td style="text-align: right;">5626.83</td>
<td style="text-align: right;">7828.64</td>
<td style="text-align: right;">13455.47</td>
<td style="text-align: right;">5626.83</td>
<td style="text-align: right;">9785.80</td>
<td style="text-align: right;">15412.63</td>
<td style="text-align: right;">45</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2015</td>
<td style="text-align: right;">100793.73</td>
<td style="text-align: right;">6047.62</td>
<td style="text-align: right;">8063.50</td>
<td style="text-align: right;">14111.12</td>
<td style="text-align: right;">6047.62</td>
<td style="text-align: right;">10079.37</td>
<td style="text-align: right;">16127.00</td>
<td style="text-align: right;">46</td>
</tr>
<tr class="even">
<td style="text-align: left;">2016</td>
<td style="text-align: right;">103817.54</td>
<td style="text-align: right;">6229.05</td>
<td style="text-align: right;">8305.40</td>
<td style="text-align: right;">14534.46</td>
<td style="text-align: right;">6229.05</td>
<td style="text-align: right;">10381.75</td>
<td style="text-align: right;">16610.81</td>
<td style="text-align: right;">47</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2017</td>
<td style="text-align: right;">106932.07</td>
<td style="text-align: right;">6415.92</td>
<td style="text-align: right;">8554.57</td>
<td style="text-align: right;">14970.49</td>
<td style="text-align: right;">6415.92</td>
<td style="text-align: right;">10693.21</td>
<td style="text-align: right;">17109.13</td>
<td style="text-align: right;">48</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018</td>
<td style="text-align: right;">110140.03</td>
<td style="text-align: right;">6608.40</td>
<td style="text-align: right;">8811.20</td>
<td style="text-align: right;">15419.60</td>
<td style="text-align: right;">6608.40</td>
<td style="text-align: right;">11014.00</td>
<td style="text-align: right;">17622.40</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2019</td>
<td style="text-align: right;">113444.23</td>
<td style="text-align: right;">6806.65</td>
<td style="text-align: right;">9075.54</td>
<td style="text-align: right;">15882.19</td>
<td style="text-align: right;">6806.65</td>
<td style="text-align: right;">11344.42</td>
<td style="text-align: right;">18151.08</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="even">
<td style="text-align: left;">2020</td>
<td style="text-align: right;">116847.56</td>
<td style="text-align: right;">7010.85</td>
<td style="text-align: right;">9347.80</td>
<td style="text-align: right;">16358.66</td>
<td style="text-align: right;">7010.85</td>
<td style="text-align: right;">11684.76</td>
<td style="text-align: right;">18695.61</td>
<td style="text-align: right;">51</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021</td>
<td style="text-align: right;">120352.98</td>
<td style="text-align: right;">7221.18</td>
<td style="text-align: right;">9628.24</td>
<td style="text-align: right;">16849.42</td>
<td style="text-align: right;">7221.18</td>
<td style="text-align: right;">12035.30</td>
<td style="text-align: right;">19256.48</td>
<td style="text-align: right;">52</td>
</tr>
<tr class="even">
<td style="text-align: left;">2022</td>
<td style="text-align: right;">123963.57</td>
<td style="text-align: right;">7437.81</td>
<td style="text-align: right;">9917.09</td>
<td style="text-align: right;">17354.90</td>
<td style="text-align: right;">7437.81</td>
<td style="text-align: right;">12396.36</td>
<td style="text-align: right;">19834.17</td>
<td style="text-align: right;">53</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023</td>
<td style="text-align: right;">127682.48</td>
<td style="text-align: right;">7660.95</td>
<td style="text-align: right;">10214.60</td>
<td style="text-align: right;">17875.55</td>
<td style="text-align: right;">7660.95</td>
<td style="text-align: right;">12768.25</td>
<td style="text-align: right;">20429.20</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="even">
<td style="text-align: left;">2024</td>
<td style="text-align: right;">131512.95</td>
<td style="text-align: right;">7890.78</td>
<td style="text-align: right;">10521.04</td>
<td style="text-align: right;">18411.81</td>
<td style="text-align: right;">7890.78</td>
<td style="text-align: right;">13151.30</td>
<td style="text-align: right;">21042.07</td>
<td style="text-align: right;">55</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the necessary library for creating the table</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the data frame for total contributions over time</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>contributions_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> <span class="dv">2005</span><span class="sc">:</span><span class="dv">2024</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Total Contributions (TRS)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">9375.00</span>, <span class="fl">10621.88</span>, <span class="fl">10940.53</span>, <span class="fl">11268.75</span>, <span class="fl">11606.81</span>, </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fl">11955.01</span>, <span class="fl">12313.66</span>, <span class="fl">12683.07</span>, <span class="fl">13063.57</span>, <span class="fl">13455.47</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fl">14111.12</span>, <span class="fl">14534.46</span>, <span class="fl">14970.49</span>, <span class="fl">15419.60</span>, <span class="fl">15882.19</span>, </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="fl">16358.66</span>, <span class="fl">16849.42</span>, <span class="fl">17354.90</span>, <span class="fl">17875.55</span>, <span class="fl">18411.81</span>),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Total Contributions (ORP)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">9375.00</span>, <span class="fl">10621.88</span>, <span class="fl">10940.53</span>, <span class="fl">11268.75</span>, <span class="fl">11606.81</span>, </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>                                  <span class="fl">11955.01</span>, <span class="fl">12313.66</span>, <span class="fl">14527.89</span>, <span class="fl">14963.72</span>, <span class="fl">15412.63</span>, </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="fl">16127.00</span>, <span class="fl">16610.81</span>, <span class="fl">17109.13</span>, <span class="fl">17622.40</span>, <span class="fl">18151.08</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>                                  <span class="fl">18695.61</span>, <span class="fl">19256.48</span>, <span class="fl">19834.17</span>, <span class="fl">20429.20</span>, <span class="fl">21042.07</span>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the table using kable</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(contributions_data, <span class="at">caption =</span> <span class="st">"Comparison of the Total Contributions over Time (2005 to 2024)"</span>, </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Total Contributions (TRS)"</span>, <span class="st">"Total Contributions (ORP)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Comparison of the Total Contributions over Time (2005 to 2024)</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Year</th>
<th style="text-align: right;">Total Contributions (TRS)</th>
<th style="text-align: right;">Total Contributions (ORP)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2005</td>
<td style="text-align: right;">9375.00</td>
<td style="text-align: right;">9375.00</td>
</tr>
<tr class="even">
<td style="text-align: right;">2006</td>
<td style="text-align: right;">10621.88</td>
<td style="text-align: right;">10621.88</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2007</td>
<td style="text-align: right;">10940.53</td>
<td style="text-align: right;">10940.53</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">11268.75</td>
<td style="text-align: right;">11268.75</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2009</td>
<td style="text-align: right;">11606.81</td>
<td style="text-align: right;">11606.81</td>
</tr>
<tr class="even">
<td style="text-align: right;">2010</td>
<td style="text-align: right;">11955.01</td>
<td style="text-align: right;">11955.01</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2011</td>
<td style="text-align: right;">12313.66</td>
<td style="text-align: right;">12313.66</td>
</tr>
<tr class="even">
<td style="text-align: right;">2012</td>
<td style="text-align: right;">12683.07</td>
<td style="text-align: right;">14527.89</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2013</td>
<td style="text-align: right;">13063.57</td>
<td style="text-align: right;">14963.72</td>
</tr>
<tr class="even">
<td style="text-align: right;">2014</td>
<td style="text-align: right;">13455.47</td>
<td style="text-align: right;">15412.63</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">14111.12</td>
<td style="text-align: right;">16127.00</td>
</tr>
<tr class="even">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">14534.46</td>
<td style="text-align: right;">16610.81</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2017</td>
<td style="text-align: right;">14970.49</td>
<td style="text-align: right;">17109.13</td>
</tr>
<tr class="even">
<td style="text-align: right;">2018</td>
<td style="text-align: right;">15419.60</td>
<td style="text-align: right;">17622.40</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: right;">15882.19</td>
<td style="text-align: right;">18151.08</td>
</tr>
<tr class="even">
<td style="text-align: right;">2020</td>
<td style="text-align: right;">16358.66</td>
<td style="text-align: right;">18695.61</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2021</td>
<td style="text-align: right;">16849.42</td>
<td style="text-align: right;">19256.48</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">17354.90</td>
<td style="text-align: right;">19834.17</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: right;">17875.55</td>
<td style="text-align: right;">20429.20</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: right;">18411.81</td>
<td style="text-align: right;">21042.07</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Conclusion:</p>
<ul>
<li>Before 2012, both plans are equally beneficial, with identical contribution amounts.</li>
<li>After 2011, ORP offers a superior retirement benefit due to the increase in employer contributions. The ORP’s 10% employer contribution outpaces TRS’s stable 8% employer contribution.</li>
<li>The gap between ORP and TRS contributions continues to grow each year as the salary increases, making ORP the better plan for employees in terms of total retirement contributions, especially for those with higher salaries or longer service years.</li>
</ul>
</section>
<section id="task-6-fixed-rate-analysis" class="level2">
<h2 class="anchored" data-anchor-id="task-6-fixed-rate-analysis">Task 6: Fixed Rate Analysis</h2>
<p>In this task, we will project an employee’s pension benefit (for TRS) and withdrawal amounts (for ORP) from retirement until death. We will use the assumptions from the previous section to estimate the fixed-rate retirement benefits for both plans and compare them over the employee’s retirement lifespan.</p>
<p>Key Assumptions:</p>
<ul>
<li>The employee retires in October 2024 at age 60.</li>
<li>The employee is expected to live until age 88, which gives them 28 years of retirement.</li>
<li>Pension Benefit is based on a fixed formula that guarantees monthly payments for life.</li>
<li>The TRS retirement benefit increases with a Cost-of-Living Adjustment (COLA) of 2% per year, based on historical averages.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set parameters for simulation</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>starting_salary <span class="ot">&lt;-</span> <span class="dv">75000</span>  <span class="co"># Starting salary for the hypothetical employee</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>salary_growth_rate <span class="ot">&lt;-</span> <span class="fl">0.03</span>  <span class="co"># Annual salary growth rate of 3%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>years_worked <span class="ot">&lt;-</span> <span class="dv">20</span>  <span class="co"># Number of years worked (2005 to 2024)</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>retirement_age <span class="ot">&lt;-</span> <span class="dv">60</span>  <span class="co"># Age at retirement</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>death_age <span class="ot">&lt;-</span> <span class="dv">88</span>  <span class="co"># Age at death</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming the total contributions in 2024 are equal for both TRS and ORP</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>total_contrib_2024 <span class="ot">&lt;-</span> <span class="fl">21042.07</span>  <span class="co"># Based on the total contribution for 2024 (from ORP)</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>COLA_rate <span class="ot">&lt;-</span> <span class="fl">0.02</span>  <span class="co"># Cost-of-living adjustment for TRS</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>investment_return_rate <span class="ot">&lt;-</span> <span class="fl">0.05</span>  <span class="co"># Average market return rate for ORP</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>retirement_years <span class="ot">&lt;-</span> death_age <span class="sc">-</span> retirement_age  <span class="co"># Number of retirement years</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to simulate TRS and ORP benefits over retirement period</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>simulate_retirement_benefits <span class="ot">&lt;-</span> <span class="cf">function</span>(total_contrib_2024, COLA_rate, investment_return_rate, retirement_years) {</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize vectors to store the pension/withdrawal values over time</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  trs_pension <span class="ot">&lt;-</span> <span class="fu">numeric</span>(retirement_years)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  orp_balance <span class="ot">&lt;-</span> <span class="fu">numeric</span>(retirement_years)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  orp_withdrawals <span class="ot">&lt;-</span> <span class="fu">numeric</span>(retirement_years)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TRS pension benefit starts with the total contribution in the final year, increases by COLA every year</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  trs_pension[<span class="dv">1</span>] <span class="ot">&lt;-</span> total_contrib_2024 <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># Monthly pension based on total contributions divided by 12 months</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>retirement_years) {</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    trs_pension[i] <span class="ot">&lt;-</span> trs_pension[i<span class="dv">-1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> COLA_rate)  <span class="co"># Apply COLA increase every year</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ORP balance grows at the investment rate, and monthly withdrawals are calculated</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  orp_balance[<span class="dv">1</span>] <span class="ot">&lt;-</span> total_contrib_2024  <span class="co"># Initial balance in ORP</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  monthly_withdrawal_orp <span class="ot">&lt;-</span> orp_balance[<span class="dv">1</span>] <span class="sc">*</span> <span class="fl">0.05</span> <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># Assumption: ORP withdrawals are based on a 5% annual return</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>retirement_years) {</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Apply 5% return to the ORP balance before withdrawal</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>      orp_balance[i] <span class="ot">&lt;-</span> orp_balance[i<span class="dv">-1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> investment_return_rate)</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Withdraw fixed monthly amount from ORP</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    orp_withdrawals[i] <span class="ot">&lt;-</span> monthly_withdrawal_orp</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the pension and ORP withdrawal data</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">Year =</span> retirement_age<span class="sc">:</span>(death_age <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">TRS_Pension =</span> trs_pension,</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">ORP_Withdrawals =</span> orp_withdrawals</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate the benefits for both TRS and ORP</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>retirement_benefits <span class="ot">&lt;-</span> <span class="fu">simulate_retirement_benefits</span>(total_contrib_2024, COLA_rate, investment_return_rate, retirement_years)</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the table comparing TRS vs ORP over retirement</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(retirement_benefits, </span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"TRS Pension (Monthly)"</span>, <span class="st">"ORP Withdrawals (Monthly)"</span>),</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Monthly Income Comparison: TRS vs ORP (2005-2024)"</span>,</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">format =</span> <span class="st">"html"</span>, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Monthly Income Comparison: TRS vs ORP (2005-2024)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">TRS Pension (Monthly)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ORP Withdrawals (Monthly)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">60</td>
<td style="text-align: right;">1753.51</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">61</td>
<td style="text-align: right;">1788.58</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">62</td>
<td style="text-align: right;">1824.35</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">63</td>
<td style="text-align: right;">1860.83</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">64</td>
<td style="text-align: right;">1898.05</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">65</td>
<td style="text-align: right;">1936.01</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">66</td>
<td style="text-align: right;">1974.73</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">67</td>
<td style="text-align: right;">2014.23</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">68</td>
<td style="text-align: right;">2054.51</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">69</td>
<td style="text-align: right;">2095.60</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">70</td>
<td style="text-align: right;">2137.51</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">71</td>
<td style="text-align: right;">2180.26</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">72</td>
<td style="text-align: right;">2223.87</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">73</td>
<td style="text-align: right;">2268.35</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">74</td>
<td style="text-align: right;">2313.71</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">75</td>
<td style="text-align: right;">2359.99</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">76</td>
<td style="text-align: right;">2407.19</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">77</td>
<td style="text-align: right;">2455.33</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">78</td>
<td style="text-align: right;">2504.44</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">79</td>
<td style="text-align: right;">2554.53</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">80</td>
<td style="text-align: right;">2605.62</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">81</td>
<td style="text-align: right;">2657.73</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">82</td>
<td style="text-align: right;">2710.88</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">83</td>
<td style="text-align: right;">2765.10</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">84</td>
<td style="text-align: right;">2820.40</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">85</td>
<td style="text-align: right;">2876.81</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">86</td>
<td style="text-align: right;">2934.35</td>
<td style="text-align: right;">87.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">87</td>
<td style="text-align: right;">2993.04</td>
<td style="text-align: right;">87.68</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="task-7-monte-carlo-analysis" class="level2">
<h2 class="anchored" data-anchor-id="task-7-monte-carlo-analysis">Task 7: Monte Carlo Analysis</h2>
<p>In this section, we present our Monte Carlo analysis results comparing the TRS (Teachers’ Retirement System) and ORP (Optional Retirement Program) plans for CUNY employees. We utilize bootstrap sampling to create 200 “bootstrap histories” from historical data on wage growth, inflation, equity returns, and bond returns. This approach allows us to generate different possible future scenarios and evaluate the retirement benefits for employees under both plans.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set parameters for simulation</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>num_bootstraps <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>starting_salary <span class="ot">&lt;-</span> <span class="dv">50000</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>retirement_age <span class="ot">&lt;-</span> <span class="dv">55</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>max_age <span class="ot">&lt;-</span> <span class="dv">85</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>initial_orp_balance <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>withdrawal_rate <span class="ot">&lt;-</span> <span class="fl">0.04</span>  <span class="co"># 4% withdrawal rate</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>final_average_salary_percentages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.0167</span>, <span class="fl">0.0175</span>, <span class="fl">0.35</span>)  <span class="co"># TRS tier percentages (example)</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all data into one data frame</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>all_data <span class="ot">&lt;-</span> wage_growth_data <span class="sc">%&gt;%</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(inflation_data, <span class="at">by =</span> <span class="st">"observation_date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(us_equity_data, <span class="at">by =</span> <span class="st">"observation_date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(intl_equity_data, <span class="at">by =</span> <span class="st">"observation_date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bond_data, <span class="at">by =</span> <span class="st">"observation_date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(short_term_debt, <span class="at">by =</span> <span class="st">"observation_date"</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Hypothetical data simulation</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>historical_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">wage_growth =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="dv">1</span>), </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">inflation =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="at">mean =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="dv">1</span>),  </span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">us_equity_returns =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="at">mean =</span> <span class="dv">7</span>, <span class="at">sd =</span> <span class="dv">5</span>),  </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">int_equity_returns =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="at">mean =</span> <span class="dv">6</span>, <span class="at">sd =</span> <span class="dv">4</span>), </span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">bond_returns =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="dv">2</span>)  </span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize lists to store results</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>orp_exhaustion_prob <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_bootstraps)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>orp_higher_income_prob <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_bootstraps)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>avg_trs_income <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_bootstraps)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>avg_orp_income <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_bootstraps)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Monte Carlo Simulation</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)  </span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_bootstraps) {</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 1: Bootstrap sampling from historical data</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  bootstrap_sample <span class="ot">&lt;-</span> historical_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(historical_data), <span class="fu">nrow</span>(historical_data), <span class="at">replace =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 2: Simulate salary growth</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>  wages <span class="ot">&lt;-</span> <span class="fu">numeric</span>(max_age <span class="sc">-</span> retirement_age <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>  wages[<span class="dv">1</span>] <span class="ot">&lt;-</span> starting_salary</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(max_age <span class="sc">-</span> retirement_age <span class="sc">+</span> <span class="dv">1</span>)) {</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>    wage_growth <span class="ot">&lt;-</span> <span class="fu">mean</span>(bootstrap_sample<span class="sc">$</span>wage_growth)</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    inflation <span class="ot">&lt;-</span> <span class="fu">mean</span>(bootstrap_sample<span class="sc">$</span>inflation)</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>    wages[j] <span class="ot">&lt;-</span> wages[j <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> wage_growth <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> inflation <span class="sc">/</span> <span class="dv">100</span>)</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 3: Simulate TRS (Defined Benefit Pension)</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>  final_salary <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">tail</span>(wages, <span class="dv">3</span>))  <span class="co"># Final Average Salary from last 3 years</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>  trs_monthly_benefit <span class="ot">&lt;-</span> final_salary <span class="sc">*</span> final_average_salary_percentages[<span class="dv">1</span>]  <span class="co"># Using the first tier percentage for calculation</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adjust TRS income for inflation each year during retirement</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>  trs_income <span class="ot">&lt;-</span> <span class="fu">numeric</span>(max_age <span class="sc">-</span> retirement_age <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>  trs_income[<span class="dv">1</span>] <span class="ot">&lt;-</span> trs_monthly_benefit</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(max_age <span class="sc">-</span> retirement_age <span class="sc">+</span> <span class="dv">1</span>)) {</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>    trs_income[k] <span class="ot">&lt;-</span> trs_income[k <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">mean</span>(bootstrap_sample<span class="sc">$</span>inflation) <span class="sc">/</span> <span class="dv">100</span>)  <span class="co"># Adjust by inflation</span></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 4: Simulate ORP (Defined Contribution Plan)</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>  orp_balance <span class="ot">&lt;-</span> initial_orp_balance</span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>  orp_income <span class="ot">&lt;-</span> <span class="fu">numeric</span>(max_age <span class="sc">-</span> retirement_age <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(max_age <span class="sc">-</span> retirement_age <span class="sc">+</span> <span class="dv">1</span>)) {</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>    orp_income[k] <span class="ot">&lt;-</span> orp_balance <span class="sc">*</span> withdrawal_rate</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>    orp_balance <span class="ot">&lt;-</span> orp_balance <span class="sc">-</span> orp_income[k]</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (orp_balance <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>      orp_balance <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 5: Track metrics for each bootstrap simulation</span></span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>  avg_trs_income[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(trs_income)</span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>  avg_orp_income[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(orp_income)</span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if ORP funds are exhausted before death</span></span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a>  orp_exhaustion_prob[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(orp_balance <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if ORP has higher monthly income than TRS in retirement</span></span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>  orp_higher_income_prob[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">mean</span>(orp_income) <span class="sc">&gt;</span> <span class="fu">mean</span>(trs_income), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate final statistics</span></span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Average Monthly TRS Income"</span>, <span class="st">"Average Monthly ORP Income"</span>, </span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Probability ORP Exhausts Before Death"</span>, <span class="st">"Probability ORP Higher Income"</span>),</span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(<span class="fu">mean</span>(avg_trs_income), <span class="fu">mean</span>(avg_orp_income),</span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mean</span>(orp_exhaustion_prob), <span class="fu">mean</span>(orp_higher_income_prob))</span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                 Metric    Value
1            Average Monthly TRS Income 1390.351
2            Average Monthly ORP Income 2315.796
3 Probability ORP Exhausts Before Death    0.000
4         Probability ORP Higher Income    1.000</code></pre>
</div>
</div>
</section>
<section id="data-driven-recommendation" class="level2">
<h2 class="anchored" data-anchor-id="data-driven-recommendation">Data-Driven Recommendation</h2>
<p>As a financial advisor, here’s my recommendation:</p>
<p><strong>TRS (Stability)</strong>: Provides stable, inflation-adjusted retirement income. Best for employees near retirement or those who prefer predictable, low-risk benefits.</p>
<p><strong>ORP (Growth)</strong>: Offers growth potential tied to market performance but comes with risks of variable income and possible depletion of savings. Best for employees with a higher risk tolerance and investment management experience.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Chloe384\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>